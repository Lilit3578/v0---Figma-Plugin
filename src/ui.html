<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="ui.css">
</head>

<body>
    <div class="container">
        <h1>Semantic Design Compiler</h1>
        <div id="iteration-info"
            style="font-size: 11px; color: var(--figma-color-text-secondary); margin-bottom: 8px; display: none;">
            Iteration 1 of 5</div>

        <div class="input-group">
            <input type="text" id="intent-input" placeholder="Describe what you want to create..." />
            <div id="char-counter"
                style="position: absolute; right: 90px; top: 10px; font-size: 10px; color: var(--figma-color-text-tertiary); pointer-events: none;">
                0 / 500</div>
            <button id="generate-btn">Generate</button>
        </div>

        <div class="history-controls">
            <button id="undo-btn" class="history-btn" disabled>‚Üê Undo</button>
            <button id="redo-btn" class="history-btn" disabled>Redo ‚Üí</button>
            <button id="undo-change-btn" class="history-btn" style="display: none;">Revert Change</button>
            <button id="clear-conv-btn" class="history-btn">Start Fresh</button>
        </div>

        <div id="cooldown-timer" style="display: none;"></div>
        <!-- Add this after the Generate button -->
        <!-- Add this after the Generate button -->
        <button id="refresh-inventory" class="secondary">üîÑ Refresh Components & Variables</button>
        <div id="cache-stats"
            style="font-size: 11px; color: var(--figma-color-text-tertiary); text-align: center; margin-top: 4px; display: none;">
        </div>

        <div id="status-area"></div>

        <details class="section">
            <summary>API Settings</summary>
            <div class="settings-content">
                <label for="api-key">Gemini API Key:</label>
                <input type="password" id="api-key" placeholder="Enter your API key">
                <button id="save-key" class="secondary">Save Key</button>

                <div class="separator" style="margin: 12px 0; border-bottom: 1px solid var(--figma-color-border);">
                </div>

                <label>Troubleshooting:</label>
                <button id="force-refresh-btn" class="secondary destructive" style="margin-top: 4px;">Delete Cache &
                    Rescan</button>

                <p class="help-text">
                    Get your free API key at
                    <a href="https://aistudio.google.com/app/apikey" target="_blank">
                        Google AI Studio
                    </a>
                </p>
            </div>
        </details>
    </div>



    <!-- Summary Dialog -->
    <div id="summary-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <div class="dialog-header">
                <h3>Generation Complete</h3>
                <button id="close-summary-btn" class="icon-btn">‚úï</button>
            </div>
            <div class="dialog-content">
                <div class="quality-badge" id="quality-badge">Good</div>

                <div class="summary-section">
                    <h4>Resolution Summary</h4>
                    <div id="tier-breakdown">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="summary-section">
                    <h4>Warnings (<span id="total-warnings-count">0</span>)</h4>
                    <ul id="warnings-list" class="warnings-list">
                        <!-- Populated by JS -->
                    </ul>
                </div>

                <div class="summary-section">
                    <h4>Recommendations</h4>
                    <ul id="recommendations-list" class="recommendations-list">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>
            <div class="dialog-footer">
                <button id="view-details-btn" class="secondary">View Details</button>
                <button id="dismiss-summary-btn" class="primary">Dismiss</button>
            </div>
        </div>
    </div>
    <!-- Approval Dialog -->
    <div id="approval-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <div class="dialog-header">
                <h3>Review Generated Design</h3>
            </div>
            <div class="dialog-content">
                <div class="confidence-section">
                    <div class="confidence-label">
                        <span>Confidence Score</span>
                        <span id="approval-confidence-score">0%</span>
                    </div>
                    <div class="confidence-bar-bg">
                        <div id="approval-confidence-fill" class="confidence-bar-fill"></div>
                    </div>
                </div>

                <div class="summary-section">
                    <h4>Why did I do this?</h4>
                    <p id="approval-reasoning" class="text-sm text-secondary"></p>
                </div>

                <div class="summary-section">
                    <h4>Key Decisions</h4>
                    <ul id="approval-decisions" class="info-list">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>
            <div class="dialog-footer">
                <button id="reject-design-btn" class="secondary destructive">Start Over</button>
                <button id="approve-design-btn" class="primary">Looks Good</button>
            </div>
        </div>
    </div>

    <!-- Clarification Dialog -->
    <div id="clarification-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <div class="dialog-header">
                <h3>I need more information</h3>
            </div>
            <div class="dialog-content">
                <div class="confidence-note warning-bg">
                    <span class="icon">‚ö†Ô∏è</span>
                    <span>Confidence is too low to generate (<span id="clarification-score">0%</span>)</span>
                </div>

                <div class="summary-section">
                    <div id="clarification-questions">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <p class="help-text">Please refine your request with more details.</p>
            </div>
            <div class="dialog-footer">
                <button id="close-clarification-btn" class="primary">I'll Try Again</button>
            </div>
        </div>
    </div>

    <!-- Antigravity Reasoning Dialog -->
    <div id="antigravity-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog" style="max-width: 520px;">
            <div class="dialog-header">
                <h3>Antigravity Reasoning</h3>
                <button id="close-antigravity-btn" class="icon-btn">‚úï</button>
            </div>
            <div class="dialog-content">
                <div class="summary-section">
                    <h4>Intent Understanding</h4>
                    <p id="antigravity-intent" class="text-sm"></p>
                </div>

                <div class="summary-section">
                    <h4>Component Selections</h4>
                    <ul id="antigravity-components" class="info-list">
                        <!-- Populated by JS -->
                    </ul>
                </div>

                <div class="summary-section">
                    <h4>Layout Rationale</h4>
                    <p id="antigravity-layout" class="text-sm text-secondary"></p>
                </div>

                <div class="summary-section" id="antigravity-warnings-section" style="display: none;">
                    <h4>Warnings</h4>
                    <ul id="antigravity-warnings" class="warnings-list">
                        <!-- Populated by JS -->
                    </ul>
                </div>

                <div class="confidence-section" style="margin-top: 16px;">
                    <div class="confidence-label">
                        <span>Overall Confidence</span>
                        <span id="antigravity-confidence">0%</span>
                    </div>
                    <div class="confidence-bar-bg">
                        <div id="antigravity-confidence-fill" class="confidence-bar-fill"></div>
                    </div>
                </div>

                <div class="timing-info"
                    style="margin-top: 12px; font-size: 11px; color: var(--figma-color-text-tertiary);">
                    <span>Intent: <span id="timing-intent">0</span>ms</span> |
                    <span>Decision: <span id="timing-decision">0</span>ms</span> |
                    <span>Build: <span id="timing-build">0</span>ms</span> |
                    <span>Total: <span id="timing-total">0</span>ms</span>
                </div>
            </div>
            <div class="dialog-footer">
                <button id="dismiss-antigravity-btn" class="primary">Got it</button>
            </div>
        </div>
    </div>

    <!-- Undo Toast -->
    <div id="undo-toast" class="undo-toast" style="display: none;">
        <span class="undo-message">‚úì Generated successfully</span>
        <div class="undo-actions">
            <button id="toast-undo-btn" class="text-btn">Undo</button>
            <button id="toast-close-btn" class="icon-btn">‚úï</button>
        </div>
        <div class="undo-timer-bar">
            <div id="undo-timer-fill" class="undo-timer-fill"></div>
        </div>
    </div>
    <script src="ui.js"></script>
</body>

</html>